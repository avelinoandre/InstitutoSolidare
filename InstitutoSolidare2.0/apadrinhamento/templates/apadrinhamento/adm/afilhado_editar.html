{% extends "shared/base_logout.html" %}
{% load static %}

{% block content %}
<div style="padding: 30px;">
    <div style="background-color: #85bce2; padding: 30px; border-radius: 20px;">
        <!-- Foto e campos -->
        <div style="display: flex; gap: 20px;">
            <div style="width: 200px; height: 200px; background-color: #ccc; border-radius: 8px;">
                {% if afilhado.foto %}
                    <img src="{{ afilhado.foto.url }}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                {% endif %}
            </div>

            <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
                <label>Nome:
                    <input type="text" id="nome" value="{{ afilhado.nome }}" style="width: 100%;">
                </label>
                <label>Data de Nascimento:
                    <input type="date" id="data_nascimento" value="{{ afilhado.data_nascimento }}">
                </label>
                <label>Usuário:
                    <input type="text" id="usuario" value="{{ afilhado.usuario }}">
                </label>
            </div>
        </div>

        <label style="display: block; margin-top: 10px;">Endereço:
            <input type="text" id="endereco" value="{{ afilhado.endereco }}" style="width: 100%;">
        </label>

        <label style="display: block; margin-top: 10px;">Tags:
            <input type="text" id="tags" value="{{ afilhado.tags }}" style="width: 100%;">
        </label>

        <div style="display: flex; gap: 20px; margin-top: 10px;">
            <label style="flex: 1;">Curso:
                <input type="text" id="curso" value="{{ afilhado.curso }}">
            </label>
            <label style="flex: 1;">Meu Sonho:
                <textarea id="sonho" style="width: 100%;">{{ afilhado.sonho }}</textarea>
            </label>
        </div>

        <!-- Botões -->
        <div style="margin-top: 20px;">
            <button onclick="salvarAfilhado({{ afilhado.id }})"
                    style="background-color: #ffd43b; padding: 10px 20px; border: none; border-radius: 6px; font-weight: bold;">
                Alterar Dados
            </button>

            <a href="{% url 'excluir_afilhado' afilhado.id %}"
               style="background-color: #ffd43b; padding: 10px 20px; border-radius: 6px; font-weight: bold; text-decoration: none; color: black; margin-left: 10px;">
                Excluir afilhado
            </a>
        </div>

        <!-- Alerta de resultado -->
        <div id="popup" style="display:none; margin-top: 20px; font-weight: bold;"></div>
    </div>
</div>

<script>
function salvarAfilhado(id) {
    const data = {
        nome: document.getElementById("nome").value,
        data_nascimento: document.getElementById("data_nascimento").value,
        usuario: document.getElementById("usuario").value,
        endereco: document.getElementById("endereco").value,
        tags: document.getElementById("tags").value,
        curso: document.getElementById("curso").value,
        sonho: document.getElementById("sonho").value
    };

    fetch(`/afilhado/${id}/`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify(data)
    })
    .then(resp => resp.json())
    .then(res => {
        const popup = document.getElementById("popup");
        popup.style.display = "block";
        popup.innerText = res.mensagem || "Atualizado com sucesso!";
        popup.style.color = res.sucesso ? "#155724" : "#721c24";
        popup.style.backgroundColor = res.sucesso ? "#d4edda" : "#f8d7da";
        popup.style.padding = "12px";
        popup.style.borderRadius = "8px";
    });
}
</script>
{% endblock %}
